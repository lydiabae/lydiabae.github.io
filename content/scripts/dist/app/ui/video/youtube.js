define(["jquery","pubsub"],function(e){var t;return window.onYouTubeIframeAPIReady=function(){var n=e(".js-video-pane-ready"),r=e(".js-video-youtube-play");t.loadVideo(n,r)},{init:function(n){t=this;var r,i,s=e(n);this._prepVideo(s),typeof YT!="undefined"&&typeof YT.Player!="undefined"?(r=e(".js-video-pane-ready"),i=e(".js-video-youtube-play"),this.loadVideo(r,i)):(this._loadAPI(),this._initSubscriptions())},loadVideo:function(n,r){var i=null,s=n.attr("id"),o=r.attr("data-video-id"),u=n.attr("data-video-height")?n.attr("data-video-height"):n.height(),a=n.attr("data-video-width")?n.attr("data-video-width"):n.height(),f=r.attr("data-video-playonload")==="true"?1:0;i=new YT.Player(s,{height:u,width:a,videoId:o,events:{onReady:t.readyToPlay},playerVars:{autoplay:f,rel:0,autohide:1}}),n.data("video.youtube",i),e.publish("/video/pauseRotator",[{playerId:s}]),this._cleanupVideo(),this._unsetPlayerToLoad(e(".js-youtube-player-load"))},_initSubscriptions:function(){e.subscribe("/video/playing",this._handlePlayingEvent),e.subscribe("/video/stop",this._stopVideoEvent)},_handlePlayingEvent:function(n){var r=n.videoid;e(".js-video-pane").each(function(){var n,i=e(this);i!==r&&(n=i.data("video.youtube"),n&&t.stopVideo(n))})},_stopVideoEvent:function(n){var r=n.videoid;e("#js-rotator").each(function(){e(this).find(".js-video-pane").each(function(){var n=e(this);n.attr("data-video-id")===r&&(t._resetVideo(n,null,!0),e.publish("/video/resumeRotator",[{videoPane:n}]))})})},_resetVideo:function(t,n,r){var i,s;if(!r){var o=t[0],u=n[0];i=e("<a>",{"class":o.className,id:o.id,href:u.href,"data-video-id":n.attr("data-video-id"),"data-video-playonload":n.attr("data-video-playonload"),"data-video-height":o.height,"data-video-width":o.width}),s=n.attr("data-video-description")}else i=t.closest("li").data("video.clone");i.insertAfter(t),r||i.closest(".js-video-container").find(".js-video-description").html(s),t.remove()},_loadAPI:function(){var e=document.createElement("script"),t=document.getElementsByTagName("script")[0];e.src="http://www.youtube.com/player_api",t.parentNode.insertBefore(e,t)},_prepVideo:function(e){var t=this._findPane(e);t.is("iframe")&&(this._resetVideo(t,e),t=this._findPane(e)),e.addClass("js-video-youtube-play"),t.addClass("js-video-pane-ready")},_cleanupVideo:function(){e(".js-video-youtube-play").removeClass("js-video-youtube-play"),e(".js-video-pane-ready").removeClass("js-video-pane-ready")},_findPane:function(e){return e.is(".js-video-pane")?e:e.closest(".js-video-player").find(".js-video-pane")},_setPlayerToLoad:function(e){e.addClass("js-youtube-player-load")},_unsetPlayerToLoad:function(e){e.removeClass("js-youtube-player-load")},readyToPlay:function(e){},stopVideo:function(e){e.stopVideo()}}});