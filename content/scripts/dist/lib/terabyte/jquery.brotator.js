(function(e){e.fn.brotator=function(t){var n={animation:"fade",animationSpeed:500,easing:"linear",autorotate:!0,timeout:8e3,content:".content",menu:".media-index",menuItem:".media-index-item",menuUpdate:"default",next:".next",previous:".previous",hasMenu:!1,menuClick:!0,hasButtons:!0,contentSetup:null,wait:!0,lazyloader:!1,zIndex:2,complete:null,namespace:null};return this.each(function(){t&&e.extend(n,t);var r=n.namespace+Math.floor(Math.random()*10001)||"/"+this.id,i=e(this),s=i.find(n.content),o=s.find("li").size();if(t==="destroy"){var u=i.data("brotator"),a=i.data("brotator_timer"),f=i.data("brotator_menu"),l=i.data("brotator_buttons"),c=i.data("brotator_content"),h=i.data("namespace");a&&a.clearAutoTimer.apply(u[0],Array.prototype.splice.call(arguments,1)),f&&f.clearEvents(),l&&l.clearEvents(),c.reset(),e.unsubscribe(h+"/transition/start"),e.unsubscribe(h+"/transition/end"),e.unsubscribe(h+"/lazyloader/get"),e.unsubscribe(h+"/state/updated"),i.data("brotator",""),i.data("brotator_timer",""),i.data("brotator_menu",""),i.data("brotator_buttons",""),i.data("brotator_content",""),i.data("namespace","");return}var p={timeoutID:null,initTriggers:function(){i.on("start.timer.brotator",function(){n.autorotate=!0,p.init.call(p)}),i.on("stop.timer.brotator",function(){n.autorotate=!1,p.clearAutoTimer.call(p)})},clearTriggers:function(){i.off("start.timer.brotator"),i.off("stop.timer.brotator")},init:function(){this.setAutoRotate(),e.subscribe(r+"/transition/start",function(e,t){t&&p.clearAutoTimer()}),e.subscribe(r+"/transition/end",function(e){n.autorotate&&p.setAutoRotate()})},setAutoRotate:function(){var t=n.timeout;n.wait||(t=50,n.wait=!0),p.timeoutID=setTimeout(function(){e.publish(r+"/transition/start",[d.next])},t),i.data("timer",p.timeoutID)},clearAutoTimer:function(){var e=i.data("timer");e&&(clearTimeout(e),n.autorotate=!1)}},d={current:0,next:1,previous:o-1,inTransition:!1,updateState:function(t){this.updateProp("current",t);var n=t<o-1?t+1:0,i=t===0?o-1:t-1;this.updateProp("next",n),this.updateProp("previous",i),this.updateProp("inTransition",!1),e.publish(r+"/state/updated",[{next:n,current:d.current}])},updateProp:function(e,t){this[e]=t},init:function(){e.subscribe(r+"/transition/start",function(){d.updateProp("inTransition",!0)}),e.subscribe(r+"/transition/end",function(e){d.updateState(e)})}},v={elem:e(n.menu),init:function(){e.subscribe(r+"/transition/start",function(e){v.updateMenu[n.menuUpdate](e)}),n.menuClick&&this.clickEvent()},clearEvents:function(){v.elem.off("click",n.menuItem)},clickEvent:function(){var t=v.elem;t.on("click",n.menuItem,function(n){n.preventDefault();if(this.className.indexOf("is-selected")===-1&&!d.inTransition){var i=t.find("li").index(e(this).closest("li"));e.publish(r+"/transition/start",[i,!0])}})},updateMenu:{"default":function(e){var t=v.elem.find(".is-selected"),n=v.elem.find("li").eq(e);t.removeClass("is-selected "),n.find("a").addClass("is-selected ")}}},m={init:function(){this.clickEvent()},nextButton:i.find(n.next),previousButton:i.find(n.previous),clearEvents:function(){e.each([this.nextButton,this.previousButton],function(){e(this).off("click")})},clickEvent:function(){e.each([this.nextButton,this.previousButton],function(){e(this).click(function(t){t.preventDefault();if(!d.inTransition){var n=this.className.indexOf("next")!==-1?d.next:d.previous;e.publish(r+"/transition/start",[n,!0])}})})}},g={imgCache:{},init:function(){this.initCache(),this.initSubscriptions()},initCache:function(){s.find("li").each(function(){var t=e(this);if(t.find("img[data-original]").length){var n=t.find("img").attr("data-original");n&&(g.imgCache[n]=t.find("img")[0])}})},initSubscriptions:function(){e.subscribe(r+"/lazyloader/get",function(e){var t=s.find("li").eq(e.next);t.find("img[data-original]").length&&!g.isImageLoaded(t)&&g.processImg(t)}),e.subscribe(r+"/state/updated",function(e){var t=s.find("li").eq(e.next);t.find("img[data-original]").length&&!g.isImageLoaded(t)&&g.processImg(t)})},processImg:function(e){var t=e.find("img"),n=t.attr("data-original");t[0].src=n},isImageLoaded:function(e){var t=e.find("img");return t[0].src.indexOf(t.attr("data-original"))!==-1},checkCache:function(e){return g.imgCache[e]},getImg:function(e){var t;return g.checkCache(e)?t=g.imgCache[e]:(t=new Image,t.src=e,t.className="rotator-header-image",g.imgCache[e]=t),t},insertImg:function(e,t){e.prepend(t)}},y={count:s.find("li").length,reset:function(){var t=s.find("li").first();s.attr("style",""),s.find("li").each(function(){e(this).attr("style","")}),t.is(".is-selected")||(s.find(".is-selected").removeClass("is-selected"),s.find("li").first().addClass("is-selected"))},init:function(){n.contentSetup&&y.contentSetup[n.contentSetup](),e.subscribe(r+"/transition/start",function(t){n.lazyloader&&e.publish(r+"/lazyloader/get",[{next:t}]),y.animations[n.animation](t)})},postTransition:function(e,t){e.removeClass("is-selected"),t.addClass("is-selected"),n.complete&&n.complete.call(t[0])},contentSetup:{responsive:function(){s.css({width:100*y.count+"%"}),s.find("li").each(function(){e(this).css({width:100/y.count+"%",display:"block"})})}},animations:{fade:function(t){var i=s.find("li"),o=i.eq(d.current),u=i.eq(t);o.css({"z-index":1}).animate({opacity:"0"},n.animationSpeed,n.easing),u.css({display:"block",opacity:"0","z-index":n.zIndex}).animate({opacity:"1"},n.animationSpeed,n.easing,function(){o.attr("style",""),y.postTransition(o,u),e.publish(r+"/transition/end",[t])})},slide:function(t){var i=s.find("li"),o=i.eq(d.current),u=i.eq(t),a=t*100;Modernizr.csstransitions?(s.css({left:a*-1+"%"}),y.postTransition(o,u),setTimeout(function(){e.publish(r+"/transition/end",[t])},500)):s.animate({left:a*-1+"%"},n.animationSpeed,n.easing,function(){y.postTransition(o,u),e.publish(r+"/transition/end",[t])})}}};if(t==="stopAutoRotate")return p.clearAutoTimer.apply(this,Array.prototype.splice.call(arguments,1));if(t==="startAutoRotate")return p.setAutoRotate.apply(this,Array.prototype.splice.call(arguments,1));typeof t!="string"&&(n.hasMenu&&v.init(),n.hasButtons&&m.init(),n.autorotate&&p.init(),p.initTriggers(),n.lazyloader&&g.init(),d.init(),y.init()),i.data("brotator")||(i.data("brotator",e(this)),i.data("brotator_timer",p),i.data("brotator_menu",v),i.data("brotator_buttons",m),i.data("brotator_content",y),i.data("namespace",r))})}})(jQuery);