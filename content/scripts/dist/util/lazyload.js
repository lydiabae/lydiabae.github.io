define(["jquery","pubsub","lazyload","lazyscroll"],function(e){var t,n=".js-lazy-content",r=".js-lazy-auto",i,s;return{init:function(){t=this,i=e(n),s=e(r),s.length&&t.loadImages(s),i.length&&t.loadContent(),this._initSubscriptions()},initLazyFunction:function(e){e.elems.lazyScroll({callback:e.callback})},_initSubscriptions:function(){e.subscribe("/lazyload/image",this.loadImages)},_loadAjaxedImages:function(e){e.html&&t.loadImagesInHtml(e.html),t.loadImages(e.images)},loadContent:function(r){r=r instanceof jQuery?r:e(e.trim(r));if(r.length){var s=r.find(n);t.content(s);return}t.content(i)},loadImages:function(e){t._getImages(e)},loadImagesInHtml:function(n){n=n instanceof jQuery?n:e(e.trim(n));if(n.length){var i=n.find(r);if(!i.length)return;t._getImages(i);return}this._getImages(s)},_getImages:function(t){var n=e(".oldie").length?"show":"fadeIn";if(!t||!t.length)return;t.filter(function(){var t=e(this);return this.src.indexOf(t.attr("data-original"))===-1}).lazyload({effect:n,failure_limit:99999,threshold:300})},content:function(e){e.lazyScroll({callback:function(){this.$element.ajaxInclude()}})}}});